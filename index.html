<link rel="stylesheet" type="text/css" href="barrel.css">

<script type="module">
    import picodash from "./dist/picodash-base.esm.js"

    var ds1 = new picodash.SimpleVariableDataSource("myDataSource", { step: 0.25 })
    await ds1.register()
    await ds1.pushData(10)


    var ds2 = new picodash.SimpleVariableDataSource("myDataSource2", {})
    await ds2.register()


    var ds3 = new picodash.SimpleVariableDataSource("demo1", {})
    await ds3.register()
    await ds3.pushData(0)

    var count = [0]

    for (var i = 0; i < 100; i++) {
        ds2.pushData(count[0])
        count[0] += 1
    }
    setInterval(function () {
        ds2.pushData(count[0])
        count[0] += 1

    }, 2500)


    class Nop extends picodash.Filter {
        constructor(s, conf, prev) {
            // Prev can be undefined, the data source object,
            // Or the previous filter
            super(s, conf, prev)
        }

        async get(unfiltered) {
            // Convert from unfiltered to filtered
            return unfiltered
        }

        async set(val) {
            // Convert from filtered to unfiltered
            return val
        }
    }

    picodash.addFilterProvider('nop', Nop)
</script>


<main>
    <h2>Picodash Demo</h2>
    <section class="window">

        <div class="stacked-form">
            <label>Random Data(Fixed Point)
                <ds-span source="random:" filter="fixedpoint: 3"></ds-span>
            </label>

            <label>Random Data(nop filter does nothing)
                <ds-meter source="random:" filter="nop:" class="w-4rem"></ds-meter>
            </label>

            <label>Readonly Data
                <ds-input source="fixed:124.6779" filter="fixedpoint: 3"></ds-input>
            </label>

            <label>Two fields with same data source
                <ds-input type="number" source="myDataSource"></ds-input>
            </label>

            <label>Two fields with same data source
                <ds-input type="number" source="myDataSource"></ds-input>
            </label>

            <label>Same data source, but with multiplier x10 filter
                <ds-input type="number" source="myDataSource" filter="mult: 10"></ds-input>
            </label>


            <label>Multiplier x50 and offset +1000 filter stacked
                <ds-input type="number" source="myDataSource" filter="mult: 50 | offset: 1000"></ds-input>
            </label>

            <label>Trigger Buttons send an incrementing counter by default
                <ds-button source="myDataSource">Press Me!</ds-button>
            </label>

            <label>Scrolling log window(x5 multiplier filter)
                <ds-logwindow source="myDataSource2" filter="mult: 5" class="scroll max-h-12rem"></ds-logwindow>
            </label>
        </div>
    </section>

    <section class="window margin">

        <div class="stacked-form">

            <label>Button can set this to a random value!
                <ds-span source="demo1" filter="fixedpoint: 3"></ds-span>
            </label>

            <p>The button uses source-pressed to set a specific value,
                which it gives the main source when pressed.
            </p>
            <p>
                We multiply the rand val by 100. Our filter stack is "fixedpoint: 1 | mult: 0.01".
            </p>
            <p>
                Note that the filters are the reverse
                order of what you'd think, because we're going from widget to source.
            </p>
            <p>Filters only apply to the primary source.</p>
            <label>
                <ds-button source="demo1" source-pressed="random:" filter="fixedpoint: 1 | mult: 0.01">Press
                    Me!</ds-button>
            </label>
        </div>
    </section>


    <script type="module">
        import picodash from "./dist/picodash-base.esm.js"
        let ds4 = new picodash.SimpleVariableDataSource('snackbar', {})
        ds4.register()

        let ds5 = new picodash.SimpleVariableDataSource('vib', {})
        ds5.register()
    </script>
    <section class="window margin">
        <div class="stacked-form">
            <p>When this value changes, put up a snackbar</p>
            <label>text

                <ds-input source="snackbar" filter="notify: You changed the value!"></ds-input>
            </label>

            <label>Vibrate on change with the vibrate: filter
                <ds-input source="vib" filter="vibrate:"></ds-input>
            </label>


            <label>Require confirmation
                <ds-input source="vib" filter="confirm: Really change value?"></ds-input>
            </label>
        </div>
    </section>
</main>